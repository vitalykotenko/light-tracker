<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Облік світла</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000000">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  background: #000;
  color: #fff;
}

.hidden { display: none; }

/* ===== HEADER ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid #1c1c1e;
}

.nav-btn {
  color: #0a84ff;
  font-size: 17px;
}

.actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 8px 12px;
  border-radius: 10px;
  background: #1c1c1e;
  color: #0a84ff;
  font-size: 14px;
}

.btn:active { background: #2c2c2e; }

.container { padding: 16px; }

/* ===== LIST ===== */
.list-item {
  padding: 14px;
  border-radius: 12px;
  background: #1c1c1e;
  margin-bottom: 8px;
  font-size: 17px;
}
.list-item:active { background: #2c2c2e; }

/* ===== MONTH GRID ===== */
.month-title {
  font-size: 22px;
  margin-bottom: 12px;
}

.grid-calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.day {
  aspect-ratio: 1 / 1;
  border-radius: 10px;
  background: #1c1c1e;
  display: flex;
  align-items: center;
  justify-content: center;
}
.day.filled { background: #1c2a3a; }
.day:active { background: #2c2c2e; }

/* ===== HOURS ===== */
.grid-hours {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}

.hour {
  aspect-ratio: 1 / 1;
  border-radius: 14px;
  background: #1c1c1e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #aaa;
}

.hour.red { background: #b3261e; color: #fff; }
.hour.green { background: #1fa14a; color: #fff; }

/* ===== MONTH TIMELINE ===== */
.day-separator {
  margin: 24px 0 8px;
  padding-top: 8px;
  border-top: 1px solid #1c1c1e;
  color: #8e8e93;
  font-size: 14px;
}

input[type="file"] { display: none; }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <div id="navBtn" class="nav-btn"></div>
  <div class="actions">
    <div class="btn" id="exportBtn">Експорт CSV</div>
    <div class="btn" id="importBtn">Імпорт CSV</div>
    <input type="file" id="fileInput" accept=".csv">
  </div>
</div>

<!-- ===== VIEWS ===== -->
<div id="yearsView" class="container hidden"></div>
<div id="monthsView" class="container hidden"></div>
<div id="monthView" class="container hidden"></div>
<div id="dayView" class="container hidden"></div>

<script>
/* ===== CONFIG ===== */
const YEARS = [2026, 2027];
const MONTHS = ["Січень","Лютий","Березень","Квітень","Травень","Червень",
                "Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"];

/* ===== STATE ===== */
let view = "month";
let currentYear, currentMonth, currentDay;

/* ===== ELEMENTS ===== */
const navBtn = document.getElementById("navBtn");
const yearsView = document.getElementById("yearsView");
const monthsView = document.getElementById("monthsView");
const monthView = document.getElementById("monthView");
const dayView = document.getElementById("dayView");
const exportBtn = document.getElementById("exportBtn");
const importBtn = document.getElementById("importBtn");
const fileInput = document.getElementById("fileInput");

/* ===== VIEW SWITCH ===== */
function show(target) {
  [yearsView, monthsView, monthView, dayView].forEach(v => v.classList.add("hidden"));
  target.classList.remove("hidden");
  updateNav();
}

/* ===== NAV BUTTON ===== */
function updateNav() {
  navBtn.textContent = "";
  navBtn.onclick = null;

  if (view === "day") {
    navBtn.textContent = `${MONTHS[currentMonth]} ${currentYear}`;
    navBtn.onclick = () => openMonth();
  }
  else if (view === "month") {
    navBtn.textContent = currentYear;
    navBtn.onclick = () => openMonths();
  }
  else if (view === "months") {
    navBtn.textContent = "Роки";
    navBtn.onclick = () => openYears();
  }
}

/* ===== OPENERS ===== */
function openYears() {
  view = "years";
  renderYears();
  show(yearsView);
}

function openMonths() {
  view = "months";
  renderMonths();
  show(monthsView);
}

function openMonth() {
  view = "month";
  renderMonth();
  show(monthView);
}

function openDay(day) {
  currentDay = day;
  view = "day";
  renderDay();
  show(dayView);
}

/* ===== YEARS ===== */
function renderYears() {
  yearsView.innerHTML = "";
  YEARS.forEach(y => {
    const d = document.createElement("div");
    d.className = "list-item";
    d.textContent = y;
    d.onclick = () => {
      currentYear = y;
      openMonths();
    };
    yearsView.appendChild(d);
  });
}

/* ===== MONTHS ===== */
function renderMonths() {
  monthsView.innerHTML = "";
  MONTHS.forEach((m, i) => {
    const d = document.createElement("div");
    d.className = "list-item";
    d.textContent = m;
    d.onclick = () => {
      currentMonth = i;
      openMonth();
    };
    monthsView.appendChild(d);
  });
}

/* ===== MONTH ===== */
function renderMonth() {
  monthView.innerHTML = "";

  const title = document.createElement("div");
  title.className = "month-title";
  title.textContent = `${MONTHS[currentMonth]} ${currentYear}`;

  const grid = document.createElement("div");
  grid.className = "grid-calendar";

  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const data = JSON.parse(localStorage.getItem(key)) || [];
    const el = document.createElement("div");
    el.className = "day";
    el.textContent = d;
    if (data.some(v => v > 0)) el.classList.add("filled");
    el.onclick = () => openDay(d);
    grid.appendChild(el);
  }

  monthView.appendChild(title);
  monthView.appendChild(grid);

  /* ===== MONTH TIMELINE ===== */
  for (let d = 1; d <= daysInMonth; d++) {
    const dateKey = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const label = document.createElement("div");
    label.className = "day-separator";
    label.textContent = `${String(d).padStart(2,"0")}.${String(currentMonth+1).padStart(2,"0")}.${currentYear}`;

    const gridHours = document.createElement("div");
    gridHours.className = "grid-hours";

    const data = JSON.parse(localStorage.getItem(dateKey)) || Array(24).fill(0);

    for (let h = 0; h < 24; h++) {
      const cell = document.createElement("div");
      cell.className = "hour";
      cell.textContent = `${String(h).padStart(2,"0")}–${String(h+1).padStart(2,"0")}`;
      if (data[h] === 1) cell.classList.add("red");
      if (data[h] === 2) cell.classList.add("green");
      gridHours.appendChild(cell);
    }

    monthView.appendChild(label);
    monthView.appendChild(gridHours);
  }
}

/* ===== DAY ===== */
function renderDay() {
  dayView.innerHTML = "";
  const grid = document.createElement("div");
  grid.className = "grid-hours";

  const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(currentDay).padStart(2,"0")}`;
  const data = JSON.parse(localStorage.getItem(key)) || Array(24).fill(0);

  for (let i = 0; i < 24; i++) {
    const h = document.createElement("div");
    h.className = "hour";
    h.textContent = `${String(i).padStart(2,"0")}–${String(i+1).padStart(2,"0")}`;
    if (data[i] === 1) h.classList.add("red");
    if (data[i] === 2) h.classList.add("green");
    h.onclick = () => {
      data[i] = (data[i] + 1) % 3;
      localStorage.setItem(key, JSON.stringify(data));
      renderDay();
    };
    grid.appendChild(h);
  }

  dayView.appendChild(grid);
}

/* ===== EXPORT / IMPORT ===== */
exportBtn.onclick = () => {
  let csv = "date," + Array.from({length:24},(_,i)=>`h${i}`).join(",") + "\n";
  Object.keys(localStorage).sort().forEach(k => {
    if (/^\d{4}-\d{2}-\d{2}$/.test(k))
      csv += k + "," + JSON.parse(localStorage.getItem(k)).join(",") + "\n";
  });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([csv], {type:"text/csv"}));
  a.download = "light-data.csv";
  a.click();
};

importBtn.onclick = () => fileInput.click();
fileInput.onchange = e => {
  const r = new FileReader();
  r.onload = () => {
    r.result.split("\n").slice(1).forEach(l => {
      if (!l.trim()) return;
      const [d,...v] = l.split(",");
      localStorage.setItem(d, JSON.stringify(v.map(Number)));
    });
    openMonth();
    alert("Імпорт завершено");
  };
  r.readAsText(e.target.files[0]);
};

/* ===== START ===== */
(() => {
  const now = new Date();
  currentYear = YEARS.includes(now.getFullYear()) ? now.getFullYear() : YEARS[0];
  currentMonth = now.getMonth();
  openMonth();
})();
</script>
</body>
</html>
