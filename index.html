<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Облік світла</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000000">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  background: #000;
  color: #fff;
}

.hidden { display: none; }

/* ===== HEADER ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid #1c1c1e;
}

.nav-btn {
  color: #0a84ff;
  font-size: 17px;
}

.actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 8px 12px;
  border-radius: 10px;
  background: #1c1c1e;
  color: #0a84ff;
  font-size: 14px;
}

.container { padding: 16px; }

/* ===== LIST ===== */
.list-item {
  padding: 14px;
  border-radius: 12px;
  background: #1c1c1e;
  margin-bottom: 8px;
  font-size: 17px;
}

/* ===== MONTH GRID ===== */
.month-title {
  font-size: 22px;
  margin-bottom: 12px;
}

.grid-calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.day {
  aspect-ratio: 1 / 1;
  border-radius: 10px;
  background: #1c1c1e;
  display: flex;
  align-items: center;
  justify-content: center;
}

.day.filled { background: #1c2a3a; }

/* ===== HOURS ===== */
.grid-hours {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}

.hour {
  aspect-ratio: 1 / 1;
  border-radius: 14px;
  background: #1c1c1e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #aaa;
}

.hour.red { background: #b3261e; color: #fff; }
.hour.green { background: #1fa14a; color: #fff; }

/* ===== PREVIEW HOURS (MONTH ONLY) ===== */
.hour-preview {
  aspect-ratio: 1 / 1;
  border-radius: 14px;
  background: #1c1c1e;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #aaa;
  pointer-events: none;
}

.hour-preview.red { background: #b3261e; color: #fff; }
.hour-preview.green { background: #1fa14a; color: #fff; }

/* ===== MONTH TIMELINE ===== */
.day-separator {
  margin: 24px 0 6px;
  padding-top: 8px;
  border-top: 1px solid #1c1c1e;
  color: #8e8e93;
  font-size: 14px;
}

.day-summary {
  margin-bottom: 8px;
  font-size: 13px;
  color: #8e8e93;
}

input[type="file"] { display: none; }
</style>
</head>
<body>

<div class="header">
  <div id="navBtn" class="nav-btn"></div>
  <div class="actions">
    <div class="btn" id="exportBtn">Експорт CSV</div>
    <div class="btn" id="importBtn">Імпорт CSV</div>
    <input type="file" id="fileInput" accept=".csv">
  </div>
</div>

<div id="monthView" class="container"></div>
<div id="dayView" class="container hidden"></div>

<script>
const MONTHS = ["Січень","Лютий","Березень","Квітень","Травень","Червень",
                "Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"];

let currentYear = 2026;
let currentMonth = 0;
let currentDay = 1;
let view = "month";

const monthView = document.getElementById("monthView");
const dayView = document.getElementById("dayView");
const navBtn = document.getElementById("navBtn");

/* ===== NAV ===== */
function updateNav() {
  if (view === "day") {
    navBtn.textContent = `${MONTHS[currentMonth]} ${currentYear}`;
    navBtn.onclick = () => openMonth();
  } else {
    navBtn.textContent = currentYear;
    navBtn.onclick = null;
  }
}

/* ===== MONTH ===== */
function openMonth() {
  view = "month";
  dayView.classList.add("hidden");
  monthView.classList.remove("hidden");
  renderMonth();
  updateNav();
}

function renderMonth() {
  monthView.innerHTML = "";

  const title = document.createElement("div");
  title.className = "month-title";
  title.textContent = `${MONTHS[currentMonth]} ${currentYear}`;

  const grid = document.createElement("div");
  grid.className = "grid-calendar";

  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const data = JSON.parse(localStorage.getItem(key)) || [];
    const el = document.createElement("div");
    el.className = "day";
    el.textContent = d;
    if (data.some(v => v > 0)) el.classList.add("filled");
    el.onclick = () => openDay(d);
    grid.appendChild(el);
  }

  monthView.appendChild(title);
  monthView.appendChild(grid);

  /* ===== ANALYTICS ===== */
  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const data = JSON.parse(localStorage.getItem(key)) || Array(24).fill(0);

    const red = data.filter(v => v === 1).length;
    const green = data.filter(v => v === 2).length;

    const sep = document.createElement("div");
    sep.className = "day-separator";
    sep.textContent = `${String(d).padStart(2,"0")}.${String(currentMonth+1).padStart(2,"0")}.${currentYear}`;

    const summary = document.createElement("div");
    summary.className = "day-summary";
    summary.textContent = `Світло є: ${green} год · Світла немає: ${red} год`;

    const gridH = document.createElement("div");
    gridH.className = "grid-hours";

    for (let h = 0; h < 24; h++) {
      const c = document.createElement("div");
      c.className = "hour-preview";
      c.textContent = `${String(h).padStart(2,"0")}–${String(h+1).padStart(2,"0")}`;
      if (data[h] === 1) c.classList.add("red");
      if (data[h] === 2) c.classList.add("green");
      gridH.appendChild(c);
    }

    monthView.appendChild(sep);
    monthView.appendChild(summary);
    monthView.appendChild(gridH);
  }
}

/* ===== DAY ===== */
function openDay(d) {
  currentDay = d;
  view = "day";
  monthView.classList.add("hidden");
  dayView.classList.remove("hidden");
  renderDay();
  updateNav();
}

function renderDay() {
  dayView.innerHTML = "";
  const grid = document.createElement("div");
  grid.className = "grid-hours";

  const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(currentDay).padStart(2,"0")}`;
  const data = JSON.parse(localStorage.getItem(key)) || Array(24).fill(0);

  for (let i = 0; i < 24; i++) {
    const h = document.createElement("div");
    h.className = "hour";
    h.textContent = `${String(i).padStart(2,"0")}–${String(i+1).padStart(2,"0")}`;
    if (data[i] === 1) h.classList.add("red");
    if (data[i] === 2) h.classList.add("green");

    h.onclick = () => {
      data[i] = (data[i] + 1) % 3;
      localStorage.setItem(key, JSON.stringify(data));
      renderDay();
    };

    grid.appendChild(h);
  }

  dayView.appendChild(grid);
}

/* ===== START ===== */
openMonth();
</script>
</body>
</html>
