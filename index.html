<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Облік світла</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">

<link rel="apple-touch-icon" href="Icon light-tracker 2.png">
<link rel="icon" type="image/png" sizes="180x180" href="Icon light-tracker 2.png">

<style>
:root {
  --bg: #000;
  --glass: rgba(28, 28, 30, 0.72);
  --glass-light: rgba(58, 58, 60, 0.55);
  --stroke: rgba(255, 255, 255, 0.18);
  --stroke-soft: rgba(255, 255, 255, 0.08);
  --accent: #0A84FF;
  --red-bright: #FF453A;
  --green-bright: #32D74B;
  --radius: 14px;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  background: var(--bg);
  color: #fff;
  -webkit-user-select: none;
  user-select: none;
}

.hidden { display: none; }

/* ===== GLASS BASE ===== */
.btn, .list-item, .day, .hour {
  background: var(--glass);
  backdrop-filter: blur(26px);
  -webkit-backdrop-filter: blur(26px);
  border: 1px solid var(--stroke);
  box-shadow: inset 0 0 0 1px var(--stroke-soft);
}

/* ===== HEADER ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid var(--stroke);
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(10px);
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-btn {
  color: var(--accent);
  font-size: 17px;
  font-weight: 500;
}

.actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 8px 14px;
  border-radius: 10px;
  color: var(--accent);
  font-size: 14px;
  font-weight: 500;
}
.btn:active { transform: scale(0.96); }

.container { padding: 16px; }

/* ===== LIST ===== */
.list-item {
  padding: 16px;
  border-radius: var(--radius);
  margin-bottom: 10px;
  font-size: 17px;
}
.list-item:active { background: var(--glass-light); }

/* ===== MONTH GRID ===== */
.month-title {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 16px;
  padding-left: 4px;
}

.grid-calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.day {
  aspect-ratio: 1;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 500;
  transition: all 0.2s;
}

/* Яркий синий как в Work Timer */
.day.filled { 
  background: var(--accent); 
  border-color: rgba(255,255,255,0.3);
  box-shadow: 0 0 15px rgba(10, 132, 255, 0.5);
}

/* ===== HOURS ===== */
.grid-hours {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}

.hour {
  aspect-ratio: 1;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  color: #8E8E93;
  font-weight: 600;
}

/* Яркие индикаторы */
.hour.red { 
  background: var(--red-bright); 
  border-color: rgba(255,255,255,0.2);
  color: #fff; 
}

.hour.green { 
  background: var(--green-bright); 
  border-color: rgba(255,255,255,0.2);
  color: #fff; 
}

/* ===== MONTH TIMELINE ===== */
.day-separator {
  margin: 30px 0 8px;
  padding-top: 12px;
  border-top: 1px solid var(--stroke);
  color: #8E8E93;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.day-summary {
  font-size: 13px;
  color: #8e8e93;
  margin-bottom: 10px;
  padding-left: 2px;
}

input[type="file"] { display: none; }
</style>
</head>
<body>

<div class="header">
  <div id="navBtn" class="nav-btn"></div>
  <div class="actions">
    <div class="btn" id="exportBtn">Експорт CSV</div>
    <div class="btn" id="importBtn">Імпорт CSV</div>
    <input type="file" id="fileInput" accept=".csv">
  </div>
</div>

<div id="yearsView" class="container hidden"></div>
<div id="monthsView" class="container hidden"></div>
<div id="monthView" class="container hidden"></div>
<div id="dayView" class="container hidden"></div>

<script>
const YEARS = [2026, 2027];
const MONTHS = ["Січень","Лютий","Березень","Квітень","Травень","Червень",
                "Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"];

let view = "month";
let currentYear, currentMonth, currentDay;

const navBtn = document.getElementById("navBtn");
const yearsView = document.getElementById("yearsView");
const monthsView = document.getElementById("monthsView");
const monthView = document.getElementById("monthView");
const dayView = document.getElementById("dayView");

function show(v) {
  [yearsView, monthsView, monthView, dayView].forEach(x => x.classList.add("hidden"));
  v.classList.remove("hidden");
  updateNav();
}

function updateNav() {
  navBtn.onclick = null;
  if (view === "day") {
    navBtn.textContent = `${MONTHS[currentMonth]} ${currentYear}`;
    navBtn.onclick = () => openMonth();
  } else if (view === "month") {
    navBtn.textContent = currentYear;
    navBtn.onclick = () => openMonths();
  } else if (view === "months") {
    navBtn.textContent = "Роки";
    navBtn.onclick = () => openYears();
  } else {
    navBtn.textContent = "";
  }
}

function openYears() {
  view = "years";
  yearsView.innerHTML = "";
  YEARS.forEach(y => {
    const d = document.createElement("div");
    d.className = "list-item";
    d.textContent = y;
    d.onclick = () => { currentYear = y; openMonths(); };
    yearsView.appendChild(d);
  });
  show(yearsView);
}

function openMonths() {
  view = "months";
  monthsView.innerHTML = "";
  MONTHS.forEach((m,i) => {
    const d = document.createElement("div");
    d.className = "list-item";
    d.textContent = m;
    d.onclick = () => { currentMonth = i; openMonth(); };
    monthsView.appendChild(d);
  });
  show(monthsView);
}

function openMonth() {
  view = "month";
  renderMonth();
  show(monthView);
}

function openDay(d) {
  currentDay = d;
  view = "day";
  renderDay();
  show(dayView);
}

function renderMonth() {
  monthView.innerHTML = "";

  const title = document.createElement("div");
  title.className = "month-title";
  title.textContent = `${MONTHS[currentMonth]} ${currentYear}`;

  const grid = document.createElement("div");
  grid.className = "grid-calendar";

  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const data = JSON.parse(localStorage.getItem(key)) || [];
    const el = document.createElement("div");
    el.className = "day";
    el.textContent = d;
    if (data.some(v => v > 0)) el.classList.add("filled");
    el.onclick = () => openDay(d);
    grid.appendChild(el);
  }

  monthView.appendChild(title);
  monthView.appendChild(grid);

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const data = JSON.parse(localStorage.getItem(key)) || Array(24).fill(0);

    const on = data.filter(v => v === 2).length;
    const off = data.filter(v => v === 1).length;

    const label = document.createElement("div");
    label.className = "day-separator";
    label.textContent = `${String(d).padStart(2,"0")}.${String(currentMonth+1).padStart(2,"0")}.${currentYear}`;

    const summary = document.createElement("div");
    summary.className = "day-summary";
    summary.textContent = `Світло є — ${on} год · Немає — ${off} год`;

    const gridHours = document.createElement("div");
    gridHours.className = "grid-hours";

    for (let h = 0; h < 24; h++) {
      const cell = document.createElement("div");
      cell.className = "hour";
      cell.textContent = `${String(h).padStart(2,"0")}–${String(h+1).padStart(2,"0")}`;
      if (data[h] === 1) cell.classList.add("red");
      if (data[h] === 2) cell.classList.add("green");
      gridHours.appendChild(cell);
    }

    monthView.appendChild(label);
    monthView.appendChild(summary);
    monthView.appendChild(gridHours);
  }
}

function renderDay() {
  dayView.innerHTML = "";
  const grid = document.createElement("div");
  grid.className = "grid-hours";

  const key = `${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(currentDay).padStart(2,"0")}`;
  const data = JSON.parse(localStorage.getItem(key)) || Array(24).fill(0);

  for (let i = 0; i < 24; i++) {
    const h = document.createElement("div");
    h.className = "hour";
    h.textContent = `${String(i).padStart(2,"0")}–${String(i+1).padStart(2,"0")}`;
    if (data[i] === 1) h.classList.add("red");
    if (data[i] === 2) h.classList.add("green");
    h.onclick = () => {
      data[i] = (data[i] + 1) % 3;
      localStorage.setItem(key, JSON.stringify(data));
      renderDay();
    };
    grid.appendChild(h);
  }
  dayView.appendChild(grid);
}

/* ===== CSV ===== */
exportBtn.onclick = () => {
  let csv = "date," + Array.from({length:24},(_,i)=>`h${i}`).join(",") + "\n";
  Object.keys(localStorage).sort().forEach(k => {
    if (/^\d{4}-\d.test(k))
      csv += k + "," + JSON.parse(localStorage.getItem(k)).join(",") + "\n";
  });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([csv], {type:"text/csv"}));
  a.download = "light-data.csv";
  a.click();
};

importBtn.onclick = () => fileInput.click();
fileInput.onchange = e => {
  const r = new FileReader();
  r.onload = () => {
    r.result.split("\n").slice(1).forEach(l => {
      if (!l.trim()) return;
      const [d,...v] = l.split(",");
      localStorage.setItem(d, JSON.stringify(v.map(Number)));
    });
    openMonth();
    alert("Імпорт завершено");
  };
  r.readAsText(e.target.files[0]);
};

/* ===== START ===== */
(() => {
  const now = new Date();
  currentYear = YEARS.includes(now.getFullYear()) ? now.getFullYear() : YEARS[0];
  currentMonth = now.getMonth();
  openMonth();
})();
</script>
</body>
</html>
